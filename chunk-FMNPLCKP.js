import{b as S}from"./chunk-M7YNLJA7.js";import{b as $,c as D,h as x}from"./chunk-RTAFBYSH.js";import{A as l,C as v,G as o,H as p,R as b,U as c,X as d,ba as h,g as y,k as n,p as s}from"./chunk-YXS2TKPT.js";import{a as P}from"./chunk-2VMXMS7J.js";var I={items:[],total:0,page:1,size:10,query:"",selected:null,selectedTutor:null,loadingList:!1,loadingDetail:!1,saving:!1,uploadingPhoto:!1,error:null};var m=class a{_state$=new y(I);state$=this._state$.asObservable();items$=this.state$.pipe(s(e=>e.items),o());total$=this.state$.pipe(s(e=>e.total),o());page$=this.state$.pipe(s(e=>e.page),o());size$=this.state$.pipe(s(e=>e.size),o());query$=this.state$.pipe(s(e=>e.query),o());selectedPet$=this.state$.pipe(s(e=>e.selected),o());selectedTutor$=this.state$.pipe(s(e=>e.selectedTutor),o());loadingList$=this.state$.pipe(s(e=>e.loadingList),o());loadingDetail$=this.state$.pipe(s(e=>e.loadingDetail),o());saving$=this.state$.pipe(s(e=>e.saving),o());uploadingPhoto$=this.state$.pipe(s(e=>e.uploadingPhoto),o());error$=this.state$.pipe(s(e=>e.error),o());get snapshot(){return this._state$.getValue()}patch(e){this._state$.next(P(P({},this.snapshot),e))}resetSelected(){this.patch({selected:null,selectedTutor:null,error:null})}upsertItem(e){let t=[...this.snapshot.items],r=t.findIndex(i=>i.id===e.id);r>=0?t[r]=e:t.unshift(e),this.patch({items:t})}removeItem(e){this.patch({items:this.snapshot.items.filter(t=>t.id!==e)})}static \u0275fac=function(t){return new(t||a)};static \u0275prov=d({token:a,factory:a.\u0275fac,providedIn:"root"})};var g=class a{http=h(D);config=h(x);list(e,t,r){let i=e-1,f=new $().set("page",String(i)).set("size",String(t));return r?.trim()&&(f=f.set("nome",r.trim())),this.http.get(`${this.config.apiBaseUrl}/v1/pets`,{params:f}).pipe(s(u=>{let E=typeof u?.page=="number"?u.page+1:e;return{items:u?.content??u?.items??[],total:u?.total??0,page:E,size:u?.size??t}}))}getById(e){return this.http.get(`${this.config.apiBaseUrl}/v1/pets/${e}`)}create(e){return this.http.post(`${this.config.apiBaseUrl}/v1/pets`,e)}update(e,t){return this.http.put(`${this.config.apiBaseUrl}/v1/pets/${e}`,t)}delete(e){return this.http.delete(`${this.config.apiBaseUrl}/v1/pets/${e}`)}uploadPhoto(e,t){let r=new FormData;return r.append("foto",t),this.http.post(`${this.config.apiBaseUrl}/v1/pets/${e}/fotos`,r)}deletePhoto(e,t){return this.http.delete(`${this.config.apiBaseUrl}/v1/pets/${e}/fotos/${t}`)}listAll(){let e=new $().set("page","0").set("size","1000");return this.http.get(`${this.config.apiBaseUrl}/v1/pets`,{params:e}).pipe(s(t=>t?.content??t?.items??[]))}static \u0275fac=function(t){return new(t||a)};static \u0275prov=d({token:a,factory:a.\u0275fac,providedIn:"root"})};var k=class a{store=h(m);api=h(g);snack=h(S);items$=this.store.items$;total$=this.store.total$;page$=this.store.page$;size$=this.store.size$;query$=this.store.query$;selectedPet$=this.store.selectedPet$;selectedTutor$=this.store.selectedTutor$;loadingList$=this.store.loadingList$;loadingDetail$=this.store.loadingDetail$;saving$=this.store.saving$;uploadingPhoto$=this.store.uploadingPhoto$;error$=this.store.error$;loadPets(){let{page:e,size:t,query:r}=this.store.snapshot;return this.store.patch({loadingList:!0,error:null}),this.api.list(e,t,r).pipe(c(i=>{this.store.patch({items:i.items,total:i.total,page:i.page,size:i.size})}),l(i=>(console.error("[PetsFacade] Erro ao listar pets:",i),this.store.patch({error:i?.error?.message??"Erro ao listar pets."}),n(null))),p(()=>this.store.patch({loadingList:!1})))}searchByName(e){return this.store.patch({query:e??"",page:1}),n(e).pipe(v(300),o(),b(()=>this.loadPets()))}goToPage(e){return this.store.patch({page:e}),this.loadPets()}loadPetDetail(e){return this.store.patch({loadingDetail:!0,error:null,selected:null,selectedTutor:null}),this.api.getById(e).pipe(c(t=>this.store.patch({selected:t})),l(t=>(this.store.patch({error:t?.error?.message??"Erro ao carregar pet."}),n(null))),p(()=>this.store.patch({loadingDetail:!1})))}createPet(e){return this.store.patch({saving:!0,error:null}),this.api.create(e).pipe(c(t=>{this.store.upsertItem(t),this.snack.success("Pet criado com sucesso.")}),l(t=>(this.store.patch({error:t?.error?.message??"Erro ao criar pet."}),this.snack.error(t?.error?.message??"Erro ao criar pet."),n(null))),p(()=>this.store.patch({saving:!1})))}updatePet(e,t){return this.store.patch({saving:!0,error:null}),this.api.update(e,t).pipe(c(r=>{this.store.upsertItem(r),this.snack.success("Pet atualizado com sucesso.")}),l(r=>(this.store.patch({error:r?.error?.message??"Erro ao atualizar pet."}),this.snack.error(r?.error?.message??"Erro ao atualizar pet."),n(null))),p(()=>this.store.patch({saving:!1})))}deletePet(e){return this.store.patch({saving:!0,error:null}),this.api.delete(e).pipe(c(()=>{this.store.removeItem(e),this.snack.success("Pet exclu\xEDdo com sucesso.")}),l(t=>(this.store.patch({error:t?.error?.message??"Erro ao excluir pet."}),this.snack.error(t?.error?.message??"Erro ao excluir pet."),n(null))),p(()=>this.store.patch({saving:!1})))}uploadPetPhoto(e,t){return this.store.patch({uploadingPhoto:!0,error:null}),this.api.uploadPhoto(e,t).pipe(c(()=>{this.store.patch({uploadingPhoto:!1}),this.snack.success("Foto do pet carregada com sucesso.")}),l(r=>(this.store.patch({error:r?.error?.message??"Erro ao carregar foto do pet."}),this.snack.error(r?.error?.message??"Erro ao carregar foto do pet."),n(null))),p(()=>this.store.patch({uploadingPhoto:!1})))}deletePetPhoto(e,t){return this.store.patch({saving:!0,error:null}),this.api.deletePhoto(e,t).pipe(c(()=>{this.store.patch({saving:!1}),this.snack.success("Foto do pet exclu\xEDda com sucesso.")}),l(r=>(this.store.patch({error:r?.error?.message??"Erro ao excluir foto do pet."}),this.snack.error(r?.error?.message??"Erro ao excluir foto do pet."),n(null))),p(()=>this.store.patch({saving:!1})))}loadAllPets(){return this.api.listAll().pipe(l(e=>(console.error("[PetsFacade] Erro ao listar todos os pets:",e),n([]))))}resetSelected(){this.store.resetSelected()}static \u0275fac=function(t){return new(t||a)};static \u0275prov=d({token:a,factory:a.\u0275fac,providedIn:"root"})};export{k as a};
