import{c as $,h as A}from"./chunk-RTAFBYSH.js";import{A as d,G as n,H as S,U as T,X as s,ba as i,g as m,k,p as o}from"./chunk-YXS2TKPT.js";import{a as l}from"./chunk-2VMXMS7J.js";var c=class r{http=i($);config=i(A);login(e){return this.http.post(`${this.config.apiBaseUrl}/autenticacao/login`,e).pipe(o(t=>({accessToken:t.access_token,refreshToken:t.refresh_token,expiresIn:t.expires_in,user:t.user})))}refresh(e){return this.http.put(`${this.config.apiBaseUrl}/autenticacao/refresh`,{},{headers:{Authorization:`Bearer ${e}`}}).pipe(o(t=>({accessToken:t.access_token,refreshToken:t.refresh_token,expiresIn:t.expires_in})))}static \u0275fac=function(t){return new(t||r)};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var y={user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,loading:!1,error:null},h=class r{_state$=new m(y);state$=this._state$.asObservable();user$=this.state$.pipe(o(e=>e.user),n());isAuthenticated$=this.state$.pipe(o(e=>e.isAuthenticated),n());loading$=this.state$.pipe(o(e=>e.loading),n());error$=this.state$.pipe(o(e=>e.error),n());accessToken$=this.state$.pipe(o(e=>e.accessToken),n());refreshToken$=this.state$.pipe(o(e=>e.refreshToken),n());get snapshot(){return this._state$.getValue()}patch(e){this._state$.next(l(l({},this.snapshot),e))}reset(){this._state$.next(y)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var u="pss_access_token",g="pss_refresh_token",p=class r{getAccessToken(){return localStorage.getItem(u)}getRefreshToken(){return localStorage.getItem(g)}setTokens(e,t){localStorage.setItem(u,e),localStorage.setItem(g,t)}clear(){localStorage.removeItem(u),localStorage.removeItem(g)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var v=class r{api=i(c);store=i(h);tokenStorage=i(p);user$=this.store.user$;isAuthenticated$=this.store.isAuthenticated$;loading$=this.store.loading$;error$=this.store.error$;initFromStorage(){let e=this.tokenStorage.getAccessToken(),t=this.tokenStorage.getRefreshToken();e&&t&&this.store.patch({accessToken:e,refreshToken:t,isAuthenticated:!0,error:null})}login(e,t){return this.store.patch({loading:!0,error:null}),this.api.login({username:e,password:t}).pipe(T(a=>{this.tokenStorage.setTokens(a.accessToken,a.refreshToken),this.store.patch({user:a.user??null,accessToken:a.accessToken,refreshToken:a.refreshToken,isAuthenticated:!0})}),o(()=>!0),d(a=>{let I=a?.error?.message??"Falha ao autenticar.";return this.store.patch({error:I,isAuthenticated:!1}),k(!1)}),S(()=>this.store.patch({loading:!1})))}setTokens(e,t){this.tokenStorage.setTokens(e,t),this.store.patch({accessToken:e,refreshToken:t,isAuthenticated:!0})}logout(){this.tokenStorage.clear(),this.store.reset()}getAccessTokenSnapshot(){return this.store.snapshot.accessToken}getRefreshTokenSnapshot(){return this.store.snapshot.refreshToken}static \u0275fac=function(t){return new(t||r)};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};export{c as a,v as b};
